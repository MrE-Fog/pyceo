#!/usr/bin/make -f

PYTHON := python2.4

configure:

build: build-stamp

build-stamp:
	mkdir build
	$(CC) -DFULL_PATH=\"/usr/lib/csc/ceo\" -o build/ceo misc/setuid-prog.c
	touch build-stamp

clean:
	dh_testdir
	dh_testroot
	dh_clean
	rm -f build-stamp
	rm -rf build/
	find py/ -name '*.pyc' -print0 | xargs -0 rm -f

install: build
	dh_testdir
	dh_testroot
	dh_clean -k 

	# configuration files will contain sensitive information
	chmod 600 etc/csc/*
	
	dh_installdirs etc usr/lib/$(PYTHON)/site-packages usr/share/csc \
	               usr/lib/csc usr/bin
	dh_install -X.svn -X.pyc py/csc usr/lib/$(PYTHON)/site-packages/
	dh_install -X.svn -X.pyc etc/csc etc/
	dh_install -X.svn -X.pyc sql/* usr/share/csc/
	
	dh_install -X.svn -X.pyc bin/ceo usr/lib/csc/
	dh_install -X.svn -X.pyc build/ceo usr/bin/
	

binary-indep: build install
	dh_testdir
	dh_testroot
	dh_installchangelogs 
	dh_installdocs docs/*
	dh_installexamples
	dh_install
#	dh_installlogrotate
#	dh_installcron
	dh_installman
	dh_link
	dh_strip
	dh_compress
	dh_fixperms
#	dh_perl
#	dh_python
#	dh_makeshlibs
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install configure

binary-arch: build install
